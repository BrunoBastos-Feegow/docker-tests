version: '3'
services:
  feegow-api:
    platform: linux/x86_64
    container_name: feegow-api
    hostname: feegow-api
    network_mode: nat
    image: php:7.4-apache
    command: >
      bash -c "
              apt-get update && 
              apt-get install -y locales &&
              apt-get install -y default-mysql-client &&
              apt-get install -y bzip2&&
              apt-get install -y libbz2-dev &&
              apt-get install -y libfreetype6-dev &&
              apt-get install -y libjpeg62-turbo-dev &&

              apt-get install -y libpng-dev &&
              apt-get install -y libicu-dev &&
              apt-get install -y libxml2-dev &&
              apt-get install -y libxslt-dev &&
              apt-get install -y libzip-dev &&
              apt-get install -y libwebp-dev &&
              apt-get install -y libonig-dev &&

              docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp &&
              docker-php-ext-install bcmath &&
              docker-php-ext-install bz2 &&
              docker-php-ext-install calendar &&
              docker-php-ext-install dba &&
              docker-php-ext-install exif &&
              docker-php-ext-install gd &&
              docker-php-ext-install gettext &&
              docker-php-ext-install intl &&
              docker-php-ext-install pdo &&
              docker-php-ext-install pdo_mysql &&
              docker-php-ext-install mbstring &&
              docker-php-ext-install soap &&
              docker-php-ext-install sockets &&
              docker-php-ext-install opcache &&
              docker-php-ext-install xmlrpc &&
              docker-php-ext-install xsl &&
              docker-php-ext-install zip &&
      
              ln -f -s /usr/share/zoneinfo/America/Sao_Paulo /etc/localtime && 
                    printf 'pt_BR.UTF-8 UTF-8\n' >> /etc/locale.gen && 
                    printf 'pt_BR ISO-8859-1\n' >> /etc/locale.gen && 
                    locale-gen &&
              pecl install redis-5.3.7 && 
              docker-php-ext-enable redis &&
              curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer &&

              sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf &&
              sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf &&
              a2enmod rewrite proxy deflate headers expires alias &&
              echo 'ServerName localhost' > /etc/apache2/conf-enabled/server-name.conf &&
              apt-get clean && 
              rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* "
#&&
#cp ./conf/php.ini /usr/local/etc/php/conf.d/zzz-app.ini &&
#cp ./conf/apache.conf /etc/apache2/conf-enabled/zzz-app.conf"


#docker-php-ext-install fileinfo &&